<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>List | 技术笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.svg">
    <meta name="description" content="技术笔记">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.48ccdae5.css" as="style"><link rel="preload" href="/assets/js/app.46e11bd5.js" as="script"><link rel="preload" href="/assets/js/7.0b9c15e1.js" as="script"><link rel="preload" href="/assets/js/2.b79aa31a.js" as="script"><link rel="preload" href="/assets/js/1.f68c1bc4.js" as="script"><link rel="preload" href="/assets/js/41.c2f43e3b.js" as="script"><link rel="preload" href="/assets/js/11.6b6e9be5.js" as="script"><link rel="prefetch" href="/assets/js/10.d068187b.js"><link rel="prefetch" href="/assets/js/14.0ccfac8c.js"><link rel="prefetch" href="/assets/js/15.22e3db1b.js"><link rel="prefetch" href="/assets/js/16.2df8879c.js"><link rel="prefetch" href="/assets/js/17.83b8e01b.js"><link rel="prefetch" href="/assets/js/18.8ca63655.js"><link rel="prefetch" href="/assets/js/19.24870089.js"><link rel="prefetch" href="/assets/js/20.f884c0b0.js"><link rel="prefetch" href="/assets/js/21.2f4e228d.js"><link rel="prefetch" href="/assets/js/22.46d9c25a.js"><link rel="prefetch" href="/assets/js/23.cdfb3272.js"><link rel="prefetch" href="/assets/js/24.46f0f18e.js"><link rel="prefetch" href="/assets/js/25.83e06166.js"><link rel="prefetch" href="/assets/js/26.50d0532c.js"><link rel="prefetch" href="/assets/js/27.d86485c2.js"><link rel="prefetch" href="/assets/js/28.e78759b9.js"><link rel="prefetch" href="/assets/js/29.3baf33d6.js"><link rel="prefetch" href="/assets/js/3.ff29b6a0.js"><link rel="prefetch" href="/assets/js/30.248edbf7.js"><link rel="prefetch" href="/assets/js/31.3a94544c.js"><link rel="prefetch" href="/assets/js/32.a35bce04.js"><link rel="prefetch" href="/assets/js/33.5c11060e.js"><link rel="prefetch" href="/assets/js/34.451797f4.js"><link rel="prefetch" href="/assets/js/35.74e12899.js"><link rel="prefetch" href="/assets/js/36.52cf6bc5.js"><link rel="prefetch" href="/assets/js/37.d32f56eb.js"><link rel="prefetch" href="/assets/js/38.c0db570e.js"><link rel="prefetch" href="/assets/js/39.d7c58cc8.js"><link rel="prefetch" href="/assets/js/4.c65e7516.js"><link rel="prefetch" href="/assets/js/40.36a6714f.js"><link rel="prefetch" href="/assets/js/42.402e80ac.js"><link rel="prefetch" href="/assets/js/43.1959c30e.js"><link rel="prefetch" href="/assets/js/44.85138f30.js"><link rel="prefetch" href="/assets/js/45.408e6e2c.js"><link rel="prefetch" href="/assets/js/46.90c9bacc.js"><link rel="prefetch" href="/assets/js/47.45095b88.js"><link rel="prefetch" href="/assets/js/5.0bfff97e.js"><link rel="prefetch" href="/assets/js/6.235c0dcb.js"><link rel="prefetch" href="/assets/js/8.044d81f3.js"><link rel="prefetch" href="/assets/js/9.213f5a61.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f7b3a7b0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.48ccdae5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>技术笔记</h3> <p class="description" data-v-59e6cb88>技术笔记</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="技术笔记" class="logo"> <span class="site-name">技术笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/java/" class="nav-link router-link-active"><i class="undefined"></i>
  Java
</a></div><div class="nav-item"><a href="/sql/" class="nav-link"><i class="undefined"></i>
  数据库
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>8</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/java/" class="nav-link router-link-active"><i class="undefined"></i>
  Java
</a></div><div class="nav-item"><a href="/sql/" class="nav-link"><i class="undefined"></i>
  数据库
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/" aria-current="page" class="sidebar-link">面向对象</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java集合</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/list.html" aria-current="page" class="active sidebar-link">List</a></li><li><a href="/java/queue.html" class="sidebar-link">Queue Deque</a></li><li><a href="/java/map.html" class="sidebar-link">Map</a></li><li><a href="/java/set.html" class="sidebar-link">Set</a></li><li><a href="/java/fail.html" class="sidebar-link">Fail-fast</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>List</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">List</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><div class="custom-block danger"><p class="title">注意JDK版本</p><h4 id="源代码基于jdk17"><a href="#源代码基于jdk17" class="header-anchor">#</a> 源代码基于JDK17</h4></div><h2 id="vector"><a href="#vector" class="header-anchor">#</a> Vector</h2> <h3 id="源码分析"><a href="#源码分析" class="header-anchor">#</a> 源码分析</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 1.Vector 是线程安全的集合,多线程操作性能不高
 * 2.推荐使用JUC集合
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span>
    
    <span class="token comment">//用于存储集合中所有的数据对象</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">;</span>

    <span class="token comment">//当前存储的数据数量</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> elementCount<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 1.表示每次扩容的大小,如果初始化时不进行设置,默认0,扩容时集合容量变为原容量的2倍
     * 2.如果初始化指定大小,例如20,每次扩容都是oldSize+20
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> capacityIncrement<span class="token punctuation">;</span>


    <span class="token comment">//指定集合大小以及扩容参数大小</span>
    <span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">int</span> capacityIncrement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Illegal Capacity: &quot;</span> <span class="token operator">+</span>
                    initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//初始化赋值给创建的数组</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//如果没有设置capacityIncrement,默认0,扩容规则 例如原始数组大小为10，扩容到20，为原数组大小的2倍</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>capacityIncrement <span class="token operator">=</span> capacityIncrement<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//指定集合大小</span>
    <span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//使用无参构造器，默认初始化的数组大小为10的集合</span>
    <span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementCount <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elementData <span class="token operator">=</span> a<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> elementCount<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * add方法触发扩容机制过程
     * 1.如果elementCount的当前值小于elementData.length的值时,不会触发扩容操作,直接在elementData[s] 索引处添加新的数据对象即可
     * 2.如果elementCount的当前值等于elementData.length的值时,就会触发扩容操作,需要调用grow()方法，申请新的扩容空间后,
     *   再执行elementData[s] 索引处添加新的数据对象即可
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">,</span> <span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            elementData <span class="token operator">=</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementData<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        elementCount <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//setSize 触发扩容机制</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> newSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果新容量大于当前数组长度 就进行扩容操作</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newSize <span class="token operator">&gt;</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            <span class="token function">grow</span><span class="token punctuation">(</span>newSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> es <span class="token operator">=</span> elementData<span class="token punctuation">;</span>
        <span class="token comment">// 如果新的容量小于当前数据长度 将之后的索引位置上的数据对象设置为null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">to</span> <span class="token operator">=</span> elementCount<span class="token punctuation">,</span> i <span class="token operator">=</span> newSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">to</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            es<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        elementCount <span class="token operator">=</span> newSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 可以进行缩容操作</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">trimToSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">// 进行缩容操作时，判断如果当前实际存储数据数量 小于 数组长度 进行缩容，反之不进行任何操作</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>elementCount <span class="token operator">&lt;</span> oldCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> elementCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//具体扩容操作 最后把旧数据复制到新的扩容数组，然后赋值给 elementData 完成扩容操作</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> <span class="token class-name">ArraysSupport</span><span class="token punctuation">.</span><span class="token function">newLength</span><span class="token punctuation">(</span>oldCapacity<span class="token punctuation">,</span>
                minCapacity <span class="token operator">-</span> oldCapacity<span class="token punctuation">,</span> <span class="token comment">/* minimum growth */</span>
                capacityIncrement <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> capacityIncrement <span class="token operator">:</span> oldCapacity
                <span class="token comment">/* preferred growth */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="初始化以及扩容总结"><a href="#初始化以及扩容总结" class="header-anchor">#</a> 初始化以及扩容总结</h3> <h4 id="_1-使用无参构造器"><a href="#_1-使用无参构造器" class="header-anchor">#</a> 1.使用无参构造器</h4> <div class="custom-block warning"><p class="title"></p><ul><li>无参构造器初始化Vector，elementData.length默认为10，capacityIncrement默认为0。</li> <li>当elementCount = 10，触发扩容操作，调用grow方法。</li> <li>因为capacityIncrement不大于0，即preferred growth为elementData.length，扩容为elementData.length的2倍。</li> <li>扩容规律为 10 -&gt; 20 -&gt; 40。</li></ul></div><h4 id="_2-不使用无参构造器"><a href="#_2-不使用无参构造器" class="header-anchor">#</a> 2.不使用无参构造器</h4> <div class="custom-block warning"><p class="title"></p><ul><li>指定capacityIncrement，例如指定capacityIncrement=20，initialCapacity=20。</li> <li>当elementCount = 20时触发扩容，调用grow方法。</li> <li>因为capacityIncrement大于0，即preferred growth = 20。</li> <li>扩容规律为 40 -&gt; 60 -&gt; 80，每次扩容都按照capacityIncrement的数值进行增量扩容。</li></ul></div><h2 id="工具类"><a href="#工具类" class="header-anchor">#</a> 工具类</h2> <h3 id="arrays-copyof"><a href="#arrays-copyof" class="header-anchor">#</a> Arrays.copyOf()</h3> <p>Arrays.copyOf(T[] original, int newLength)方法。
该方法是一个工具性质的方法，主要用于将原始数组(original)复制为一个新的数组，后者的长度为指定的新长度(newLength)。 按照这样的描述，对于指定的新长度(newLength)，会出现以下两种情况。</p> <ul><li>指定的新长度(newLength)小于原始数组(original)的长度，那么原始数组(original)无法复制的部分会被抛弃。</li> <li>指定的新长度(newLength)大于或等于原始数组(original)的长度，那么原始数组(original)中的所有数据对象(的引用)会按照原来的索引位被依次复制到新的数组中，新数组中多出来的空余部分会被填充为 null</li></ul> <h3 id="arrayssupport-newlength-int-oldlength-int-mingrowth-int-prefgrowth"><a href="#arrayssupport-newlength-int-oldlength-int-mingrowth-int-prefgrowth" class="header-anchor">#</a> ArraysSupport.newLength(int oldLength, int minGrowth, int prefGrowth)</h3> <p>该方法同样是一个工具性质的方法，主要用于帮助数组在扩容前在不同的场景中找到 新的数组容量，并且防止新的数组容量超过系统规定的数组容量上限。该方法的参数如下。</p> <ul><li>oldLength:扩容前的数组容量。</li> <li>minGrowth:最小的容量增量(必须为正数)。</li> <li>prefGrowth:常规的容量增量，该值需要大于 minGrowth 的值，否则会被忽略。</li></ul> <p><strong>在计算扩容后数组容量的过程中，如果 prefGrowth 的值大于 minGrowth 的值，则以prefGrowth 的值计算扩容后的新容量，否则以 minGrowth 的值计算扩容后的新容量。</strong></p> <h2 id="arraylist"><a href="#arraylist" class="header-anchor">#</a> ArrayList</h2> <h3 id="源码分析-2"><a href="#源码分析-2" class="header-anchor">#</a> 源码分析</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ArrayList 非线程安全集合</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>
<span class="token punctuation">{</span>
    
    <span class="token comment">//默认初始化容量，在使用无参构造器创建ArrayList时</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_CAPACITY</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">//使用有参构造器并且initialCapacity=0时，赋值给 elementData </span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token constant">EMPTY_ELEMENTDATA</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//使用无参构造器,赋值给 elementData</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//用于存储数据的数组,transient修饰,自定义序列化</span>
    <span class="token keyword">transient</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">;</span>

    <span class="token comment">//当前实际数据大小  </span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>

    <span class="token comment">//创建一个指定initialCapacity大小的数组,如果initialCapacity=0,相当于无参构造器创建一样</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token constant">EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span>
        <span class="token comment">// 不支持initialCapacity为0     </span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Illegal Capacity: &quot;</span><span class="token operator">+</span>
                    initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//创建一个空数组,在第一次add添加数据的时候才会创建一个默认大小为10的数组</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                elementData <span class="token operator">=</span> a<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// replace with empty array.  </span>
            elementData <span class="token operator">=</span> <span class="token constant">EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//支持缩容</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">trimToSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elementData <span class="token operator">=</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token operator">?</span> <span class="token constant">EMPTY_ELEMENTDATA</span>
                    <span class="token operator">:</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">,</span> <span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            elementData <span class="token operator">=</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementData<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        size <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// minCapacity = size + 1 </span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> elementData <span class="token operator">!=</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> <span class="token class-name">ArraysSupport</span><span class="token punctuation">.</span><span class="token function">newLength</span><span class="token punctuation">(</span>oldCapacity<span class="token punctuation">,</span>
                    minCapacity <span class="token operator">-</span> oldCapacity<span class="token punctuation">,</span> <span class="token comment">/* minimum growth */</span>
                    oldCapacity <span class="token operator">&gt;&gt;</span> <span class="token number">1</span>           <span class="token comment">/* preferred growth */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CAPACITY</span><span class="token punctuation">,</span> minCapacity<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="初始化以及扩容总结-2"><a href="#初始化以及扩容总结-2" class="header-anchor">#</a> 初始化以及扩容总结</h3> <h4 id="_1-使用无参构造器-2"><a href="#_1-使用无参构造器-2" class="header-anchor">#</a> 1.使用无参构造器</h4> <div class="custom-block warning"><p class="title"></p><ul><li>初始化一个容量为0的数组，即elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA。</li> <li>当后续第一次执行添加操作会立即执行扩容操作调用grow方法，初始化一个默认为10的ArrayList集合。</li> <li>后续当s == 10，也就是说默认长度为10的数组已经满数据，会进一步进行扩容。</li> <li>满足条件oldCapacity &gt; 0，执行扩容逻辑 oldCapacity &gt;&gt; 1 也就是 10/2，旧容量10 新容量15，相当于扩容为原数组大小的1.5倍。</li></ul></div><h4 id="_2-不使用无参构造器-2"><a href="#_2-不使用无参构造器-2" class="header-anchor">#</a> 2.不使用无参构造器</h4> <div class="custom-block warning"><p class="title"></p><ul><li>会初始化一个容量为initialCapacity的数组。</li> <li>如果initialCapacity=0，执行步骤相当于无参构造器的初始化扩容。</li> <li>如果initialCapacity&gt;0，会初始化一个容量为initialCapacity的数组，这时候第一次执行添加操作不会立即扩容操作。</li> <li>当s == elementData.length触发扩容，如果指定初始化ArrayList大小，相当于比无参构造器少一次立即初始化的步骤 。</li></ul></div><h2 id="vector与arraylist对比"><a href="#vector与arraylist对比" class="header-anchor">#</a> Vector与ArrayList对比</h2> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">Vector</th> <th style="text-align:left;">ArrayList</th></tr></thead> <tbody><tr><td style="text-align:left;">内部结构</td> <td style="text-align:left;">基于数组，初始化容量值默认10，使用者可以指定容量</td> <td style="text-align:left;">基于数组，默认初始化为0的空数组，第一次添加数据，会扩容到10，使用者也可以自定义初始化的值</td></tr> <tr><td style="text-align:left;">扩容机制</td> <td style="text-align:left;">默认扩容按照原数组的2倍进行扩容，可以指定扩容大小，即如果指定为20则每次扩容都按照原数组大小+20进行扩容</td> <td style="text-align:left;">扩容按照原数组的1.5倍进行扩容,使用者不能干预扩容逻辑,除非扩容前容量小于10</td></tr> <tr><td style="text-align:left;">线程安全</td> <td style="text-align:left;">线程安全</td> <td style="text-align:left;">线程不安全</td></tr> <tr><td style="text-align:left;">序列化</td> <td style="text-align:left;">没有对集合序列化做特殊优化处理,elementData多余的索引位会一起被序列化,造成不必要的性能消耗</td> <td style="text-align:left;">对elementData序列化做了特殊处理,只对索引位有数据的进行序列化处理,未被使用的索引位,不做序列化操作</td></tr></tbody></table> <h2 id="stack"><a href="#stack" class="header-anchor">#</a> Stack</h2> <h3 id="源码分析-3"><a href="#源码分析-3" class="header-anchor">#</a> 源码分析</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
 * 1.LIFO栈结构，extend Vector，扩容规则同Vector，也不会对序列化和反序列化进行优化处理
 * 2.Stack 集合内部结构仍然是一个数组，使用数组的尾部模拟栈结构的栈顶，使用数组的头部模拟栈结构的栈底
 * 3.不推荐使用，如果需要栈结构，建议使用ArrayDeque
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

  
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">E</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">addElement</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">E</span>       obj<span class="token punctuation">;</span>
        <span class="token keyword">int</span>     len <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        obj <span class="token operator">=</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">removeElementAt</span><span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span>     len <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EmptyStackException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">elementAt</span><span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1224463164541339165L</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="linkedlist"><a href="#linkedlist" class="header-anchor">#</a> LinkedList</h2> <h3 id="源码分析-4"><a href="#源码分析-4" class="header-anchor">#</a> 源码分析</h3> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">/*
  * 1.LinkedList 集合同时实现了List和Queue集合的基本特性
  * 2.主要结构是双向链表，双向链表的节点不要求有连续的内存存储，即插入节点的时候不需要申请连续的存储空间
  * 3.不存在扩容操作
  */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">extends</span> <span class="token class-name">AbstractSequentialList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span>
    <span class="token comment">//当前链表的长度</span>
    <span class="token keyword">transient</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">/*
     * first == null &amp;&amp; last == null 表示双向链表没有任何数据对象
     * first == last 双向链表只有一个对象
     * first != null &amp;&amp; last != null 表示双向链表至少有一个数据对象
     */</span>
    <span class="token comment">//记录双向链表的头节点</span>
    <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> first<span class="token punctuation">;</span>
    <span class="token comment">//记录双向链表的尾节点</span>
    <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> last<span class="token punctuation">;</span>

    <span class="token comment">/*
    void dataStructureInvariants() {
        assert (size == 0)        ? (first == null &amp;&amp; last == null)        : (first.prev == null &amp;&amp; last.next == null);}
    */</span>

    <span class="token keyword">public</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addAll</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">linkFirst</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用一个临时变量记录操作前first属性中的信息</span>
        <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> first<span class="token punctuation">;</span>
        <span class="token comment">// 创建一个数据信息为e的新节点，此节点的前置节点引用为null，后置节点引用指向原来的头节点</span>
        <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 这句很关键，由于要在双向链表的头部添加新的节点， 因此实际上会基于newNode节点将first属性中的信息进行重设置</span>
        first <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token comment">// 如果条件成立，则说明在进行添加操作时，双向链表中没有任何节点</span>
            <span class="token comment">// 因此需要将双向链表中的last属性也指向新节点，让first属性和last属性指向同一个节点</span>
            last <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token comment">// 如果条件不成立，则说明在操作前双向链表中至少有一个节点，</span>
            <span class="token comment">// 因此只需将原来头节点的前置节点引用指向新的头节点newNode</span>
            f<span class="token punctuation">.</span>prev <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
        <span class="token comment">// 双向链表长度 + 1</span>
        size<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">// LinkedList 集合的操作次数 + 1</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">E</span> <span class="token function">unlinkFirst</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// assert f == first &amp;&amp; f != null;</span>
        <span class="token comment">// 定义一个element变量，用于记录当前双向链表头节点中的数据对象，以便方法最后将其返回</span>
        <span class="token keyword">final</span> <span class="token class-name">E</span> element <span class="token operator">=</span> f<span class="token punctuation">.</span>item<span class="token punctuation">;</span>
        <span class="token comment">// 创建一个next变量，用于记录当前双向链表头节点的后置节点引用。注意该变量的值可能为null</span>
        <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> next <span class="token operator">=</span> f<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        f<span class="token punctuation">.</span>item <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// help GC</span>
        <span class="token comment">// 设置双向链表中新的头节点为当前节点的后续节点</span>
        first <span class="token operator">=</span> next<span class="token punctuation">;</span>
        <span class="token comment">// 如果条件成立，则说明在完成头节点的移除操作后，双向链表中已没有任何节点了</span>
        <span class="token comment">// 需要同时将双向链表中的next变量和last属性值设置为null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            last <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token comment">// 在其他情况下，设置新的头节点的前置节点引用为null，因为原来的前置节点引用指向操作前的头节点</span>
            next<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        size<span class="token operator">--</span><span class="token punctuation">;</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> element<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// add方法默认在尾节点之后添加新节点</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">linkLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 默认头节点</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">addFirst</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">//当前Node节点存储的具体的数据对象</span>
        <span class="token class-name">E</span> item<span class="token punctuation">;</span>
        <span class="token comment">//当前节点指向的下一个节点，尾节点的next永远为null</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span>
        <span class="token comment">//当前节点指向的上一个节点，头节点的prev永远为null</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> prev<span class="token punctuation">;</span>

        <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> prev<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>item <span class="token operator">=</span> element<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>prev <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="linkedlist与arraylist对比"><a href="#linkedlist与arraylist对比" class="header-anchor">#</a> LinkedList与ArrayList对比</h2> <h4 id="_1-写操作对比"><a href="#_1-写操作对比" class="header-anchor">#</a> 1.写操作对比</h4> <div class="custom-block warning"><p class="title"></p><h4 id="arraylist写操作"><a href="#arraylist写操作" class="header-anchor">#</a> ArrayList写操作：</h4> <ul><li>使用add在数据尾部添加新的数据对象时，数组中有多余容量可以直接添加操作，基本上没有时间消耗，时间复杂度O(1)。</li> <li>当在尾部添加新的数据对象时，数组容量已满，会执行一次扩容操作，把新扩容的数据赋值给elementData 再进行添加数据。</li> <li>ArrayList写最差的情况是 一直在数组中的 0号索引位置一直使用add添加对象，这样的情况，每添加一个新对象，都会将当前数组的对象整体向后移动一个索引位置，并且在数据中没有多余容量的情况下，会先进行扩容，这个操作可以规避。</li></ul> <h4 id="linkedlist写操作"><a href="#linkedlist写操作" class="header-anchor">#</a> LinkedList写操作：</h4> <ul><li>如果在双向链表的头节点以及尾节点中添加新的数据对象，只需要更改更节点或者尾节点的引用信息，在这种操作下，基本上没有时间消耗，时间复杂度O(1)。</li> <li>如果不是在尾节点或者头节点，最坏情况下，无论是从双向链表的头节点开始查询，还是尾节点开始查询，找到正确索引位的时间复杂度都是O(n)。</li></ul></div><h4 id="_2-读操作对比"><a href="#_2-读操作对比" class="header-anchor">#</a> 2.读操作对比</h4> <div class="custom-block warning"><p class="title"></p><h4 id="arraylist读操作"><a href="#arraylist读操作" class="header-anchor">#</a> ArrayList读操作：</h4> <ul><li>因为ArrayList支持随机访问，无论操作者是要遍历数组中的数据对象，还是指定索引位的数据对象，读操作的性能消耗都是相同的，时间复杂度均为O(1)。</li></ul> <h4 id="linkedlist读操作"><a href="#linkedlist读操作" class="header-anchor">#</a> LinkedList读操作：</h4> <ul><li>如果操作者从双向链表的头节点或尾节点读取数据，那么由于头节点和尾节点分别有first属性和last属性进行标识，因此不存在查询过程的额外耗时，直接读取数据即可。</li> <li>如果操作者并非在双向链表的头节点或尾节点读取数据，那么肯定存在查询过程，而查询过程都是依据节点间的引用关系遍历双向链表的。不过LinkedList集合对查 询过程做了一些优化处理。例如，根据当前指定的索引位是在双向链表的前半段，还是在双向链表的后半段，确定是从双向链表的头节点开始查询，还是从双向链表的尾节点开始查询，最差的情况是读取数据位于双向链表中部，这样无论是从头节点开始查询，还是尾节点开始查询，性能消耗都差不多。</li> <li>总而言之，在双向链表中查询指定索引位上数据对象的平均时间复杂度为O(n)。</li></ul></div><h2 id="copyonwritearraylist"><a href="#copyonwritearraylist" class="header-anchor">#</a> CopyOnWriteArrayList <span class="badge tip" style="vertical-align:top;" data-v-8f29db2c>JUC并发集合-并发版ArrayList</span></h2> <h3 id="源码分析-5"><a href="#源码分析-5" class="header-anchor">#</a> 源码分析</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">8673264195747942595L</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     *  jdk17   基于synchronized内置锁
     * -jdk17   ReentrantLock
     */</span>
    <span class="token keyword">final</span> <span class="token keyword">transient</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 该属性是一个数组，主要用于存储集合中的数据</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>
    
    <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> array<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        array <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 默认的构造方法，当前array数组的集合容量为1，并且唯一的索引位上的数据对象为null
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 该构造方法可以接受一个外部第三方集合，并且对其进行实例化</span>
    <span class="token comment">// 在进行实例化时，第三方集合中的数据对象会被复制(引用)到新创建的CopyOnWriteArrayList集 合的对象中</span>
    <span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> es<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            es <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            es <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                es <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> es<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 该构造方法从外部接受一个数组，并且使用Arrays.copyOf()方法</span>
    <span class="token comment">// 形成CopyOnWriteArrayList集合中基于array数组存储的数据对象(引用)</span>
    <span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">[</span><span class="token punctuation">]</span> toCopyIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>toCopyIn<span class="token punctuation">,</span> toCopyIn<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//CopyOnWriteArrayList 集合在进行数据写操作时，会依靠一个副本进行操作，所 以不支持必须对原始数据进行操作的功能</span>
    <span class="token comment">//不支持在迭代器上进行的数据对象更改 操作(使用 remove()方法、set()方法和 add()方法)</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">COWSubListIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">ListIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ListIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> it<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> offset<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>

        <span class="token class-name">COWSubListIterator</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> offset<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>
            it <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">listIterator</span><span class="token punctuation">(</span>index <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">nextIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> size<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">previousIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">nextIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">nextIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> offset<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">previousIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">previousIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> offset<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//迭代过程中不允许通过迭代器直接进行移除操作</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//迭代过程中不允许通过迭代器直接进行修改操作</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//迭代过程中不允许通过迭代器直接进行添加操作</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forEachRemaining</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                action<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre></div><h3 id="主要方法"><a href="#主要方法" class="header-anchor">#</a> 主要方法</h3> <ul><li>get(int)方法<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
 * get(int)方法主要用于从CopyOnWriteArrayList集合中获取指定索引位上的数据对象，
 * 该方法无须保证线程安全性，任何操作者、任何线程、任何时间点都可以使用该方法
 * 或类似方法获取CopyOnWriteArrayList 集合中的数据对象，
 * 因为该集合中的所有写操作都在一个内存副本中进行，所以任何读操作都不会受影响
 */</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">elementAt</span><span class="token punctuation">(</span><span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">E</span> <span class="token function">elementAt</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>add(E e)方法<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/* 
 * 在add()方法所有处理逻辑开始前，先进行CopyOnWriteArrayList集合的操作权获取操作，
 * 它并不影响 CopyOnWriteArrayList 集合的读操作，因为根据前面介绍get()方法的源码可知，
 * CopyOnWriteArrayList 集合的读操作完全无视锁权限，也不会有多线程场景中的数据操作问题。
 * 类似于add()方法的写操作方法需要获取操作权的原因是，
 * 防止其他线程可能对CopyOnWriteArrayList集合同时进行写操作，从而造成数据错误
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> es <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">int</span> len <span class="token operator">=</span> es<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
          <span class="token comment">/*
           * 该集合通过Arrays.copyOf()方法(其内部是System.arraycopy方法)创建一个新的内存空间，
           * 用于存储副本数组，并且在副本数组中进 行写操作，最后将 CopyOnWriteArrayList 集合中的数组引用为副本数组
           * 没有JCF中的扩容机制,每次add操作都会在原数组大小的基础上+1,然后把当前数据添加,因此集合不适用与频繁写操作的场景
           */</span>
          es <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          es<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
          <span class="token function">setArray</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>set(int index, E element)方法<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// set(int, E)方法主要用于替换 CopyOnWriteArrayList 集合指定数组索引位上的数据对象。该方法的操作过程和 add()方法类似</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> es <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 获取这个数组指定索引位上的原始数据对象</span>
          <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementAt</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 如果原始数据对象和将要重新设置的数据对象不同(依据内存地址)， </span>
          <span class="token comment">// 则创建一个新的副本并进行替换</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>oldValue <span class="token operator">!=</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              es <span class="token operator">=</span> es<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              es<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 为了保证外部调用者调用的非 volatile 修饰的变量遵循 happen−before 原则</span>
          <span class="token comment">// Ensure volatile write semantics even when oldvalue == element</span>
          <span class="token function">setArray</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <div class="custom-block warning"><p class="title"></p><ul><li>该集合适合应用于多线程并发操作场景中，如果使用集合的场景中不涉及多线程并发操作，那么不建议使用该集合，甚至不建议使用<code>JUC</code>中的任何集合，使用<code>JCF</code>场景的基本集合即可</li> <li>该集合在多线程并发操作场景中，优先关注点集中在 <strong>如何保证集合的线程安全性和集合的数据读操作性能</strong>。因此，该集合以显著牺牲自身的写操作性能和内存空间的方式换取读操作性能不受影响。这个特征很好理解，在每次进行读操作前，都要创建一个内存副本，这种操作一定会对内存空间造成浪费，并且内存空间复制操作一定会造成多余的性能消耗。</li> <li>该集合适合应用于多线程并发操作、多线程读操作次数远远多于写操作次数、集合 中存储的数据规模不大的场景中。</li></ul></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/java/" class="prev router-link-active">
          面向对象
        </a></span> <span class="next"><a href="/java/queue.html">
          Queue Deque
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/java/list.html#vector" class="sidebar-link reco-side-vector" data-v-b57cc07c>Vector</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#源码分析" class="sidebar-link reco-side-源码分析" data-v-b57cc07c>源码分析</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#初始化以及扩容总结" class="sidebar-link reco-side-初始化以及扩容总结" data-v-b57cc07c>初始化以及扩容总结</a></li><li class="level-2" data-v-b57cc07c><a href="/java/list.html#工具类" class="sidebar-link reco-side-工具类" data-v-b57cc07c>工具类</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#arrays-copyof" class="sidebar-link reco-side-arrays-copyof" data-v-b57cc07c>Arrays.copyOf()</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#arrayssupport-newlength-int-oldlength-int-mingrowth-int-prefgrowth" class="sidebar-link reco-side-arrayssupport-newlength-int-oldlength-int-mingrowth-int-prefgrowth" data-v-b57cc07c>ArraysSupport.newLength(int oldLength, int minGrowth, int prefGrowth)</a></li><li class="level-2" data-v-b57cc07c><a href="/java/list.html#arraylist" class="sidebar-link reco-side-arraylist" data-v-b57cc07c>ArrayList</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#源码分析-2" class="sidebar-link reco-side-源码分析-2" data-v-b57cc07c>源码分析</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#初始化以及扩容总结-2" class="sidebar-link reco-side-初始化以及扩容总结-2" data-v-b57cc07c>初始化以及扩容总结</a></li><li class="level-2" data-v-b57cc07c><a href="/java/list.html#vector与arraylist对比" class="sidebar-link reco-side-vector与arraylist对比" data-v-b57cc07c>Vector与ArrayList对比</a></li><li class="level-2" data-v-b57cc07c><a href="/java/list.html#stack" class="sidebar-link reco-side-stack" data-v-b57cc07c>Stack</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#源码分析-3" class="sidebar-link reco-side-源码分析-3" data-v-b57cc07c>源码分析</a></li><li class="level-2" data-v-b57cc07c><a href="/java/list.html#linkedlist" class="sidebar-link reco-side-linkedlist" data-v-b57cc07c>LinkedList</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#源码分析-4" class="sidebar-link reco-side-源码分析-4" data-v-b57cc07c>源码分析</a></li><li class="level-2" data-v-b57cc07c><a href="/java/list.html#linkedlist与arraylist对比" class="sidebar-link reco-side-linkedlist与arraylist对比" data-v-b57cc07c>LinkedList与ArrayList对比</a></li><li class="level-2" data-v-b57cc07c><a href="/java/list.html#copyonwritearraylist" class="sidebar-link reco-side-copyonwritearraylist" data-v-b57cc07c>CopyOnWriteArrayList</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#源码分析-5" class="sidebar-link reco-side-源码分析-5" data-v-b57cc07c>源码分析</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#主要方法" class="sidebar-link reco-side-主要方法" data-v-b57cc07c>主要方法</a></li><li class="level-3" data-v-b57cc07c><a href="/java/list.html#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.46e11bd5.js" defer></script><script src="/assets/js/7.0b9c15e1.js" defer></script><script src="/assets/js/2.b79aa31a.js" defer></script><script src="/assets/js/1.f68c1bc4.js" defer></script><script src="/assets/js/41.c2f43e3b.js" defer></script><script src="/assets/js/11.6b6e9be5.js" defer></script>
  </body>
</html>
